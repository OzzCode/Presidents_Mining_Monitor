{% extends "base.html" %}

{% block title %}Operations Metrics{% endblock %}

{% block content %}
<div class="container metrics-page">
    <section class="page-header">
        <h1>Operations Metrics</h1>
        <p class="muted">Unified view of fleet health, individual miners, and quick access to advanced tools.</p>
    </section>

    <section class="fleet-summary">
        <h2>Fleet Snapshot</h2>
        <div class="metrics">
            <div class="card"><h3>Total Power</h3><p id="fleet-total-power">-- W</p></div>
            <div class="card"><h3>Total Hashrate</h3><p id="fleet-total-hashrate">-- TH/s</p></div>
            <div class="card"><h3>Uptime Peak</h3><p id="fleet-total-uptime">--</p></div>
            <div class="card"><h3>Average Temp</h3><p id="fleet-avg-temp">-- °C</p></div>
            <div class="card"><h3>Average Fan Speed</h3><p id="fleet-avg-fan">-- RPM</p></div>
            <div class="card"><h3>Active Miners</h3><p id="fleet-active-count">--</p></div>
        </div>
        <p class="muted" id="fleet-last-update">Last updated: —</p>
    </section>

    <section class="focused-miner">
        <div class="section-header">
            <h2>Focused Miner</h2>
            <div class="miner-select">
                <label for="miner-select">Select active miner</label>
                <select id="miner-select" aria-label="Select active miner">
                    <option value="">Loading…</option>
                </select>
            </div>
        </div>
        <div id="miner-focus" class="card-grid">
            <div class="card"><h3>Hashrate</h3><p id="focus-hashrate">-- TH/s</p></div>
            <div class="card"><h3>Power</h3><p id="focus-power">-- W</p></div>
            <div class="card"><h3>Temperature</h3><p id="focus-temp">-- °C</p></div>
            <div class="card"><h3>Fan Speed</h3><p id="focus-fan">-- RPM</p></div>
            <div class="card"><h3>Status</h3><p id="focus-status">--</p></div>
            <div class="card"><h3>Last Seen</h3><p id="focus-last-seen">--</p></div>
        </div>
        <div class="focus-actions">
            <a id="focus-open-ui" class="btn" href="#" target="_blank" rel="noopener">Open Miner UI</a>
        </div>
    </section>

    <section class="live-miners">
        <div class="section-header">
            <h2>Live Miners</h2>
            <div>
                <label class="toggle">
                    <input type="checkbox" id="show-stale">
                    <span>Show stale miners</span>
                </label>
            </div>
        </div>
        <div class="table-wrapper">
            <table class="miners-table" id="active-miners">
                <thead>
                <tr>
                    <th>Status</th>
                    <th>Model</th>
                    <th>IP</th>
                    <th>Last Seen</th>
                    <th>Est. Power (W)</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="active-miner-body">
                <tr><td colspan="6" class="muted">Loading miners…</td></tr>
                </tbody>
            </table>
        </div>
        <div class="table-wrapper" id="stale-wrapper" hidden>
            <h3>Stale Miners</h3>
            <table class="miners-table" id="stale-miners">
                <thead>
                <tr>
                    <th>Status</th>
                    <th>Model</th>
                    <th>IP</th>
                    <th>Last Seen</th>
                    <th>Est. Power (W)</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="stale-miner-body">
                <tr><td colspan="6" class="muted">No stale miners detected.</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="quick-links">
        <h2>Deep Dive &amp; Controls</h2>
        <div class="card-grid">
            <a class="card link-card" href="{{ url_for('dashboard.analytics_page') }}">
                <h3>Analytics</h3>
                <p>Explore historical performance and advanced anomaly detection.</p>
            </a>
            <a class="card link-card" href="{{ url_for('dashboard.remote_control_page') }}">
                <h3>Remote Operations</h3>
                <p>Execute remote commands and firmware flashing from one control hub.</p>
            </a>
            <a class="card link-card" href="{{ url_for('dashboard.electricity_page') }}">
                <h3>Electricity &amp; Costs</h3>
                <p>Track energy usage, tariffs, and profitability impacts.</p>
            </a>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
    <script src="{{ url_for('static', filename='js/metrics.js') }}"></script>
{% endblock %}
