<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Error Logs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<nav><a href="{{ url_for('home') }}">Home</a></nav>
<h1>Error Logs</h1>

<div class="controls">
    <select id="level">
        <option value="">All levels</option>
        <option>ERROR</option>
        <option>WARNING</option>
        <option>INFO</option>
        <option>DEBUG</option>
    </select>
    <input id="ip" placeholder="IP (optional)"/>
    <input id="since" type="datetime-local"/>
    <button id="load">Load</button>
</div>

<table class="table">
    <thead>
    <tr>
        <th>Time</th>
        <th>Level</th>
        <th>Component</th>
        <th>IP</th>
        <th>Message</th>
    </tr>
    </thead>
    <tbody id="tbody"></tbody>
</table>

<script>
    async function loadLogs() {
        let url = '/api/error-logs?limit=200';
        const lvl = document.getElementById('level').value;
        const ip = document.getElementById('ip').value.trim();
        const s = document.getElementById('since').value;
        if (lvl) url += `&level=${encodeURIComponent(lvl)}`;
        if (ip) url += `&ip=${encodeURIComponent(ip)}`;
        if (s) url += `&since=${new Date(s).toISOString()}`;
        const res = await fetch(url);
        const data = await res.json();
        const tb = document.getElementById('tbody');
        tb.innerHTML = '';
        data.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${r.created_at}</td><td>${r.level}</td><td>${r.component}</td><td>${r.miner_ip || ''}</td><td>${r.message}</td>`;
            tb.appendChild(tr);
        });
    }

    document.getElementById('load').addEventListener('click', loadLogs);
    window.addEventListener('DOMContentLoaded', loadLogs);
</script>
</body>
</html>
