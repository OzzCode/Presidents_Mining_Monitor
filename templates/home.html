<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Antminer Monitor Home</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/theme.js') }}" defer></script>
</head>
<body>
<nav>
    <h1 style="display:flex;align-items:center;gap:10px;margin:0;">
        <img src="{{ url_for('static', filename='img/LogoImg.png') }}" alt="Company Logo"
             style="height:36px;width:auto;">
        <a href="{{ url_for('home') }}" style="text-decoration:none;color:inherit;">Antminer Monitor</a>
    </h1>
    <ul class="nav-list">
        <li><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
        <li><a href="{{ url_for('dashboard.show_miners') }}">Miners</a></li>
        <li><a href="{{ url_for('dashboard.alerts_page') }}">Alerts</a></li>
        <li><a href="{{ url_for('dashboard.profitability_page') }}">Profitability</a></li>
        <li><a href="{{ url_for('dashboard.analytics_page') }}">Analytics</a></li>
    </ul>
    <div style="display:flex; align-items:center; gap:12px;">
        <div id="btc-header-widget"
             style="display:flex; align-items:center; gap:12px; padding:8px 12px; border:1px solid var(--border); background: var(--surface-2); border-radius:10px; flex:1 1 420px; max-width:640px;">
            <div style="display:flex; flex-direction:column; line-height:1.1; flex:0 0 auto;">
                <div style="font-size:0.8rem; color: var(--muted); margin-bottom:2px;">Current BTC Price</div>
                <div id="btc-price" style="font-weight:700; font-size:1.15rem;">â€”</div>
                <div id="btc-updated" style="font-size:0.8rem; color: var(--muted);">â€”</div>
            </div>
            <div style="flex:1 1 auto; min-width:140px; height:44px;">
                <canvas id="btc-chart" height="44"></canvas>
            </div>
        </div>
        <button class="theme-toggle" id="themeToggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">ðŸŒ“</span>
            Theme
        </button>
        <div>
            {% if g.user %}
                <span style="margin-right:8px; color: var(--muted);">Hello, {{ g.user.username }}</span>
                <a class="btn" href="{{ url_for('auth.logout') }}">Logout</a>
            {% else %}
                <a class="btn" href="{{ url_for('auth.login') }}">Login</a>
            {% endif %}
        </div>
    </div>
</nav>
{#<div class="header-banner" style="margin:12px 0;">#}
{#    <img src="{{ url_for('static', filename='img/Presidents_Mining_DashHeader.png') }}" alt="Dashboard Header" style="max-width:100%; height:auto; display:block; border-radius:8px;">#}
{#</div>#}

<!-- Quick actions -->
<div style="margin:12px 0;">
    <a href="/dashboard/pools"
       style="display:inline-block; background:#2a6df4;
       color:#fff; padding:8px 12px; border-radius:6px;
       text-decoration:none;">Add Mining Pool</a>
</div>

<!-- Include Chart.js once if not already present anywhere -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<!-- Timescale adapter for date axes -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

<!-- KPI row (optional) -->
<div id="farm-kpis" style="display:flex; gap:16px; flex-wrap:wrap; margin-bottom:12px;">
    <div class="kpi-card">
        <div class="kpi-label">Total Hashrate</div>
        <div class="kpi-value" id="kpi-hash">â€”</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-label">Total Power (est.)</div>
        <div class="kpi-value" id="kpi-power">â€”</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-label">Avg Temp</div>
        <div class="kpi-value" id="kpi-temp">â€”</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-label">Workers</div>
        <div class="kpi-value" id="kpi-workers">â€”</div>
    </div>
</div>

<!-- Overview charts -->
<div class="dashboard-grid" style="margin-top:12px;">
    <div class="chart-card">
        <h3>Farm Hashrate (TH/s)</h3>
        <div class="chart-wrap">
            <canvas id="overview-hash"></canvas>
        </div>
    </div>
    <div class="chart-card">
        <h3>Farm Power (W)</h3>
        <div class="chart-wrap">
            <canvas id="overview-power"></canvas>
        </div>
    </div>
    <div class="chart-card">
        <h3>Farm Temp / Fan</h3>
        <div class="chart-wrap">
            <canvas id="overview-tempfan"></canvas>
        </div>
    </div>
    <div class="chart-card" style="grid-column: 1 / -1;">
        <h3>Active Pools (by miner)</h3>
        <div id="overview-pools"
             style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; margin-top:8px;"></div>
        <div id="overview-pools-status" style="font-size:0.9rem;color:#6b7280; margin-top:6px;"></div>
    </div>
</div>

<div class="controls-bar" style="margin:12px 0; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
    <label>
        Show miners active within
        <select id="fresh-within" style="margin-left:6px;">
            <option value="15">15 min</option>
            <option value="30" selected>30 min</option>
            <option value="60">60 min</option>
            <option value="180">3 hours</option>
            <option value="720">12 hours</option>
            <option value="1440">24 hours</option>
        </select>
    </label>
    <label style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="active-only" checked>
        Active-only
    </label>
    <span id="active-window-badge" style="font-size:0.9rem;color:#6b7280;"></span>
</div>

<!-- Attach the script -->
<script src="{{ url_for('static', filename='js/btc_widget.js') }}?v=5"></script>
<script src="/static/js/overview.js"></script>

</body>
</html>
